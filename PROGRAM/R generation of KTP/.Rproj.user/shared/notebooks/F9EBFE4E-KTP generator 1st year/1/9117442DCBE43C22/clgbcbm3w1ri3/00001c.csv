"0","library(dplyr)"
"0",""
"0","# читаем все темы из базы"
"0","all_topics <- read.table(""all_topics.csv"", header = T, sep = "";"")"
"0",""
"0","# Делим темы на три части"
"0","main <- all_topics[all_topics$Type == ""Main"" & all_topics$Year == Learning_year, ]"
"0","main$Number <- 1:nrow(main)"
"0",""
"0","addition <- all_topics[all_topics$Type == ""Addition"" & all_topics$Year == Learning_year, ]"
"0","if(! is.na(Addition_day))  addition$Number <- 1:nrow(addition) "
"0",""
"0","excursion <- all_topics[all_topics$Type == ""Excursion"" & all_topics$Year == Learning_year, ]"
"0","if(! is.na(Excursion_day)) excursion$Number <- 1:nrow(excursion)"
"0",""
"0",""
"0",""
"0","# Фрмируем датафрейм с числами занятий "
"0","all_days <- data.frame(Date = seq(as.Date(First_day), as.Date(Last_day), by=""days""))"
"0","all_days$Week_day = weekdays(all_days$Date)"
"0","all_days$Month <- months(all_days$Date)"
"0",""
"0","all_days <- all_days[!(all_days$Date %in% as.Date(holydays)), ] # удаляем праздники"
"0",""
"0",""
"0",""
"0",""
"0","# Соединяем в одном датафрейме даты и темы основных занятий"
"0","main_days_date <- all_days[all_days$Week_day %in% Main_days, ] "
"0","main_days_date$Number <- 1:nrow(main_days_date)"
"0","main <- merge(main_days_date, main, by = ""Number"")"
"0",""
"0","# Соединяем в одном датафрейме даты и темы факультативных занятий"
"0","addition_days_date <- all_days[all_days$Week_day %in% Addition_day[1], ] "
"0","addition_day_number <- as.numeric(Addition_day[2])"
"0",""
"0","addition_days_date <- addition_days_date %>% group_by(Month) %>% do(tibble(Date = .$Date[addition_day_number], Week_day = .$Week_day[addition_day_number], Month = .$Month[addition_day_number] ))"
"0",""
"0","addition_days_date <- addition_days_date[order(addition_days_date$Date), ]"
"0","if(! is.na(Addition_day)) addition_days_date$Number <- 1:nrow(addition_days_date)"
"0",""
"0","if(! is.na(Addition_day)) addition <- merge(addition, addition_days_date, by = ""Number"")"
"0",""
"0",""
"0","# Соединяем в одном датафрейме даты и темы экскурсий"
"0",""
"0","excursion_days_date <- all_days[all_days$Week_day %in% Excursion_day[1], ] "
"0","excursion_day_number <- as.numeric(Excursion_day[2])"
"0",""
"0","excursion_days_date <- excursion_days_date %>% group_by(Month) %>% do(tibble(Date = .$Date[excursion_day_number], Week_day = .$Week_day[excursion_day_number], Month = .$Month[excursion_day_number] ))"
"0",""
"0","excursion_days_date <- excursion_days_date[order(excursion_days_date$Date), ]"
"0","if(! is.na(Excursion_day)) excursion_days_date$Number <- 1:nrow(excursion_days_date)"
"0",""
"0","if(! is.na(Excursion_day)) excursion <- merge(excursion, excursion_days_date, by = ""Number"")"
"0",""
"0","# Соединяем все три датафрейма в один"
"0",""
"0","ktp <- rbind(excursion, addition, main)"
"0",""
"0","ktp <- ktp[order(ktp$Date), ]"
"0",""
"0","ktp$Date <- format(ktp$Date, ""%d/%m/%y"")"
"0",""
"0","ktp_print <- data.frame(Number = 1:nrow(ktp), Topic = ktp$Topic, All_time = ktp$Theory + ktp$Practice, Theory = ktp$Theory, Practice = ktp$Practice,  Date = ktp$Date, Fact = NA)"
